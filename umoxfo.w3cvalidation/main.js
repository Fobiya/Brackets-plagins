"use strict";define((e,t,a)=>{const n=brackets.getModule("utils/AppInit"),s=brackets.getModule("language/CodeInspection"),o=brackets.getModule("command/CommandManager"),r=brackets.getModule("document/DocumentManager"),i=brackets.getModule("extensibility/ExtensionManager"),u=brackets.getModule("utils/ExtensionUtils"),l=brackets.getModule("command/Menus"),c=new(brackets.getModule("utils/NodeDomain"))("nu.validator",u.getModulePath(a,"node/ValidationServer")),d="nu.validator",m={url:"http://localhost:8888/?out=json",type:"POST",contentType:"text/html; charset=utf-8",data:"",cache:!1,processData:!1};function g(e){const t=new $.Deferred,a={errors:[]};return m.data=e,$.ajax(m).done(e=>{e.messages.forEach(e=>{let t;switch(e.type){case"info":t=s.Type.WARNING;break;case"error":t=s.Type.ERROR}a.errors.push({pos:{line:(e.firstLine?e.firstLine:e.lastLine)-1,ch:e.firstColumn},endPos:{line:e.lastLine-1,ch:e.lastColumn},message:e.message,type:t})}),t.resolve(a)}).fail(()=>{new Promise(e=>setTimeout(e,1e3*(Math.random()+1))).then(()=>g(e))}),t.promise()}o.register("Refresh W3C validation","nu.validator.refresh",function(){r.getCurrentDocument().notifySaved()}),l.getMenu(l.AppMenuBar.EDIT_MENU).addMenuItem("nu.validator.refresh","F9"),c.exec("run").done(()=>{n.appReady(()=>{s.register("html",{name:d,scanFileAsync:g}),i.on("statusChange",(e,t)=>{"umoxfo.w3cvalidation"===t&&c.exec("exit")})})})});