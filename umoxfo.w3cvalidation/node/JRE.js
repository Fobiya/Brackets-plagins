"use strict";const execFile=require("child_process").execFile,os=require("os"),path=require("path"),request=require("request"),tar=require("tar-fs"),zlib=require("zlib"),JRE=require("./dependency.json").JRE;let platform,javaBinDir="bin";switch(os.platform()){case"darwin":platform="macosx",javaBinDir="Contents/Home/bin";break;case"win32":platform="windows";break;case"linux":platform="linux"}const jreDir=path.join(__dirname,"jre");function check(){return new Promise((e,r)=>{execFile("java",["-version"],(i,a,t)=>{t.substring(14,t.lastIndexOf('"'))>=JRE.version?e():r()})}).catch(()=>install())}process.env.PATH+=path.join(path.delimiter,jreDir,javaBinDir);const option=()=>{let e=os.arch();switch(e){case"x64":break;case"x86":case"ia32":e="i586"}return{url:`https://download.oracle.com/otn-pub/java/jdk/${JRE.product_version}-b${JRE.build_number}/${JRE.hash}/jre-${JRE.product_version}-${platform}-${e}.tar.gz`,rejectUnauthorized:!1,agent:!1,headers:{connection:"keep-alive",Cookie:"gpw_e24=http://www.oracle.com/; oraclelicense=accept-securebackup-cookie"}}};function install(){return new Promise((e,r)=>{request.get(option()).pipe(zlib.createUnzip()).pipe(tar.extract(jreDir,{map:e=>(e.name=e.name.replace(/.*?\//,""),e),readable:!0,writable:!0})).on("finish",()=>e()).on("error",e=>r(e))})}module.exports.checkJRE=check;